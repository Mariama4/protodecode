# protodecode

`protodecode` - небольшая Python-библиотека для декодирования protobuf-данных без `.proto`-схем.

Основной сценарий: у вас есть "сырой" protobuf/gRPC payload (в hex или base64), и нужно быстро посмотреть содержимое полей в человекочитаемом виде.

## Что умеет

- Принимает вход как `hex` строку (с пробелами, переносами, `0x`) или `base64`.
- Пытается автоматически пропустить gRPC-префикс кадра (`1 байт flag + 4 байта length`) для uncompressed сообщений.
- Поддерживает wire-типы `varint` (`0`), `fixed64` (`1`), `length-delimited` (`2`), `fixed32` (`5`).
- Для `length-delimited` выбирает представление в порядке `вложенный protobuf -> UTF-8 строка -> hex-байты`.

## Быстрый старт

### Установка

Требуется `Python >= 3.6`.

Локально из директории проекта:

```bash
pip install .
```

Или в editable-режиме для разработки:

```bash
pip install -e .
```

### Использование

```python
from protodecode import decode_grpc

# hex
print(decode_grpc("08 96 01"))                  # ['150']
print(decode_grpc("12 05 68 65 6c 6c 6f"))      # ['hello']

# вложенный protobuf
print(decode_grpc("0a 03 08 96 01"))            # [['150']]

# gRPC-framed payload (00 + длина + protobuf)
print(decode_grpc("00 00 00 00 03 08 96 01"))   # ['150']

# base64
print(decode_grpc("CJYB"))                      # ['150']
```

## Публичный API

### `decode_grpc(data: str) -> list`

Единственная экспортируемая функция пакета.

- Вход: строка в `hex` или `base64`.
- Выход: список декодированных значений в порядке следования полей.

Примечание: функция возвращает именно значения, без номеров полей и без полного дерева метаданных wire-формата.

## Ограничения и особенности

- Без `.proto` невозможно восстановить точные имена полей и исходные типы на 100%.
- Если вход содержит только hex-символы (`0-9a-f`), он будет интерпретирован как `hex`, а не `base64`.
- Для `fixed32` библиотека пытается интерпретировать значение как `int/uint/float` и возвращает наиболее "читаемый" вариант.
- Для `length-delimited` данные в первую очередь трактуются как вложенный protobuf, что может давать неочевидный результат на бинарных blob'ах.
- При частично поврежденном сообщении библиотека декодирует все, что удалось прочитать до ошибки.
- В репозитории пока нет автотестов (`test/test_decoder.py` пустой).

## Структура проекта

- `protodecode/proto_decoder.py` - основной декодер protobuf.
- `protodecode/buffer_reader.py` - побайтовое чтение и обработка gRPC-заголовка.
- `protodecode/varint.py` - декодирование varint.
- `protodecode/fixed.py` - декодирование fixed32/fixed64.
- `protodecode/utils.py` - парсинг входной строки (hex/base64) и утилиты.
- `setup.py` - параметры упаковки и публикации.
